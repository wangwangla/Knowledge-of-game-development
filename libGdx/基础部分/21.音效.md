# 音效

libgdx提供了播放小音效以及大的音乐。暂停和播放，会自定暂停和播放，还提供了对音频硬件的方便读写的访问，所有对于音频的访问都是通过音频模块完成的

在libgdx中音效和音乐自身没有太多的重写，它是调用了Android自带的音效和音乐播放。

在使用过程中需要注意的就是，同时播放的音效个数不可以超过32个，这个是android底层代码写好的，自己没什么办法

有点手机在播放音效的时候存在卡顿，播放音效的时间会比较长。


```java
Audio audio = Gdx.audio;
```


## 音频

libgdx后端使用的是soundpool来播放音效，使用MediaPlayer播放音乐。

- 延迟不是很好，对于节奏游戏延迟敏感的不建议使用默认的。
- 同时播放多个声音的导致出现性能问题

```java
new AsynchronousAndroidAudio(context,config);
```

可以使用Oboe

## 播放PCM

音频模块可以直接访问音频硬件，以便写入PCM样本。音频的硬件通过AudioDevice接口抽象出来。

创建一个新的AudioDevice实例
AudioDevice device = Gdx.audio.newAudioDevice(44100,true);

我们可以将16为pcm或者32位pcm数据写入设备。

```
float[] floatPCM = ... generated from a sine for example ...
device.writeSamples(floatPCM, 0, floatPCM.length);

short[] shortPCM = ... generated from a decoder ...
device.writeSamples(shortPCM, 0, shortPCM.length);
```

如果是立体声，那么就交错，左右。

以毫秒位单位进行延迟。，延迟事件越大，音频写入到底接收者的事件就越长。但是手机的这个延迟都很高，没有办法解决。

## 录制PCM

通过AudioRecorder接口从 PC 或 Android 手机上的麦克风访问 PCM 数据。要创建该接口的实例，请使用：

AudioRecorder recorder = Gdx.audio.newAudioRecorder(22050, true);
这将创建AudioRecorder一个采样率为 22.05khz 的单声道模式。如果无法创建记录器，GdxRuntimeException则会抛出 a。

样本可以读取为 16 位签名 PCM：

short[] shortPCM = new short[1024]; // 1024 samples
recorder.readSamples(shortPCM, 0, shortPCM.length);
立体声样本像往常一样交错（第一个样本 -> 左声道，第二个样本 -> 右声道）。

AnAudioRecorder是本机资源，如果不再使用，则需要丢弃：


## 总结：pcm没啥暖用

## 音效

音效一般是比较小的音频样本，一般只为几秒钟。

音效可以使用多种形式mp3/ogg/wav
wav比较大，ogg在iso上不起作用，MP3存在无缝对接的问题。

sound一般不超过1mb(pcm大小)

声音效果由Sound接口表示。加载音效的工作原理如下：

Sound sound = Gdx.audio.newSound(Gdx.files.internal("data/mysound.mp3"));
"mysound.mp3"这会加载从内部目录调用的音频文件data。

一旦我们加载了声音，我们就可以播放它：

sound.play(1.0f);
这将以全音量播放一次音效。单个Sound实例上的 play 方法可以连续调用多次，例如对于游戏中的一系列击球，并将相应地覆盖。

更细粒度的控制是可用的。每次调用都会Sound.play()返回一个 long 来标识该声音实例。使用这个句柄，我们可以修改特定的播放实例：

```java
long id = sound.play(1.0f); // play new sound and keep handle for further manipulation
sound.stop(id);             // stops the sound instance immediately
sound.setPitch(id, 2);      // increases the pitch to 2x the original pitch

id = sound.play(1.0f);      // plays the sound a second time, this is treated as a different instance
sound.setPan(id, -1, 1);    // sets the pan of the sound to the left side at full volume
sound.setLooping(id, true); // keeps the sound looping
sound.stop(id);             // stops the looping sound 
```

多种声音会导致 Android 冻结永久链接
如音频主题所述，Android 通常在音频方面存在许多问题。其中之一是等待声音 ID 可能需要相当长的时间。Libgdx 中的声音默认是同步播放的。如果您一次播放大量声音，它会导致主循环冻结很长时间。尤其是这个问题在 Android 10 上很明显。

解决方案是让它们异步播放。但是，它会导致无法在需要 ID 的情况下使用声音方法.

## music

任何超过几秒的声音，最好使用磁盘流进行传输

加载

```
Music music = Gdx.audio.newMusic("Gdx.files.internal("mymusic.mp3"));
```

播放

```
music.play();
```

设置各种属性

```
music.setVolume(0.5f);
music.setLooping(true);
music.stop();
music.pause();
music.play();
```
### 注意

一般的music不超过10个，同时播放不超过2个。